<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base Wallet Analytics</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0b0f;
            --bg-secondary: #12141c;
            --bg-card: #1a1d28;
            --bg-card-hover: #242836;
            --accent-blue: #0052ff;
            --accent-cyan: #00d4ff;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-orange: #f59e0b;
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border-color: #2d3348;
            --glow-blue: 0 0 20px rgba(0, 82, 255, 0.4);
            --glow-cyan: 0 0 20px rgba(0, 212, 255, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated background */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 82, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 82, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .bg-glow {
            position: fixed;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            filter: blur(150px);
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }

        .bg-glow-1 {
            top: -200px;
            right: -200px;
            background: var(--accent-blue);
        }

        .bg-glow-2 {
            bottom: -200px;
            left: -200px;
            background: var(--accent-purple);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            text-align: center;
            padding: 40px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 24px;
            box-shadow: var(--glow-blue);
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            margin-top: 8px;
            font-size: 1.1rem;
        }

        /* Search Section */
        .search-section {
            max-width: 700px;
            margin: 0 auto 50px;
        }

        .search-box {
            display: flex;
            gap: 12px;
            background: var(--bg-card);
            padding: 8px;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            border-color: var(--accent-blue);
            box-shadow: var(--glow-blue);
        }

        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 16px 20px;
            font-size: 1rem;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            outline: none;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-btn {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow-cyan);
        }

        .search-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 60px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 3px solid var(--bg-card);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--text-secondary);
        }

        /* Results */
        .results {
            display: none;
        }

        .results.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Wallet Header Card */
        .wallet-header {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .wallet-avatar {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .wallet-address {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        .wallet-balance {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
        }

        .wallet-balance-usd {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Wallet Score */
        .wallet-score {
            text-align: center;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--accent-cyan) var(--score-percent, 0%), var(--bg-secondary) 0%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .score-circle::before {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            background: var(--bg-card);
            border-radius: 50%;
        }

        .score-value {
            position: relative;
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .score-label {
            margin-top: 10px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Personality Badge */
        .personality-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .personality-badge {
            display: inline-flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card-hover));
            padding: 20px 40px;
            border-radius: 100px;
            border: 2px solid var(--accent-purple);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.2);
        }

        .personality-icon {
            font-size: 3rem;
        }

        .personality-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .personality-desc {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-4px);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
        }

        .stat-icon.blue { background: rgba(0, 82, 255, 0.2); }
        .stat-icon.green { background: rgba(16, 185, 129, 0.2); }
        .stat-icon.red { background: rgba(239, 68, 68, 0.2); }
        .stat-icon.orange { background: rgba(245, 158, 11, 0.2); }
        .stat-icon.purple { background: rgba(139, 92, 246, 0.2); }
        .stat-icon.cyan { background: rgba(0, 212, 255, 0.2); }

        .stat-title {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-sub {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .stat-sub.green { color: var(--accent-green); }
        .stat-sub.red { color: var(--accent-red); }

        /* Achievements */
        .achievements-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .achievements-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .achievement {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-secondary);
            padding: 12px 20px;
            border-radius: 100px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .achievement.unlocked {
            border-color: var(--accent-orange);
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.2);
        }

        .achievement.locked {
            opacity: 0.4;
        }

        .achievement-icon {
            font-size: 1.5rem;
        }

        .achievement-name {
            font-weight: 500;
        }

        /* Heatmap */
        .heatmap-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .heatmap-container {
            overflow-x: auto;
        }

        .heatmap {
            display: flex;
            gap: 4px;
            padding: 10px 0;
        }

        .heatmap-week {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .heatmap-day {
            width: 14px;
            height: 14px;
            border-radius: 3px;
            background: var(--bg-secondary);
            transition: all 0.2s ease;
        }

        .heatmap-day:hover {
            transform: scale(1.3);
        }

        .heatmap-day.level-1 { background: rgba(0, 212, 255, 0.2); }
        .heatmap-day.level-2 { background: rgba(0, 212, 255, 0.4); }
        .heatmap-day.level-3 { background: rgba(0, 212, 255, 0.6); }
        .heatmap-day.level-4 { background: rgba(0, 212, 255, 0.8); }
        .heatmap-day.level-5 { background: var(--accent-cyan); }

        .heatmap-legend {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            justify-content: flex-end;
        }

        .heatmap-legend span {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        /* Transactions */
        .transactions-section {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid var(--border-color);
        }

        .tx-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .tx-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .tx-item:hover {
            background: var(--bg-card-hover);
        }

        .tx-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tx-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .tx-icon.in { background: rgba(16, 185, 129, 0.2); }
        .tx-icon.out { background: rgba(239, 68, 68, 0.2); }

        .tx-hash {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent-cyan);
            text-decoration: none;
        }

        .tx-hash:hover {
            text-decoration: underline;
        }

        .tx-time {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .tx-value {
            text-align: right;
        }

        .tx-amount {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .tx-amount.in { color: var(--accent-green); }
        .tx-amount.out { color: var(--accent-red); }

        .tx-status {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Error */
        .error {
            display: none;
            text-align: center;
            padding: 40px;
            background: var(--bg-card);
            border-radius: 20px;
            border: 1px solid var(--accent-red);
        }

        .error.active {
            display: block;
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .error-message {
            color: var(--accent-red);
            font-size: 1.2rem;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        footer a {
            color: var(--accent-cyan);
            text-decoration: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .search-box {
                flex-direction: column;
            }

            .search-btn {
                width: 100%;
            }

            .wallet-header {
                flex-direction: column;
                text-align: center;
            }

            .wallet-info {
                flex-direction: column;
            }

            .stat-value {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>

    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">B</div>
                <h1>Base Wallet Analytics</h1>
            </div>
            <p class="subtitle">Deep insights into any Base wallet ‚Ä¢ Personality ‚Ä¢ Achievements ‚Ä¢ Stats</p>
        </header>

        <div class="search-section">
            <div class="search-box">
                <input type="text" class="search-input" id="addressInput" placeholder="Enter wallet address (0x...)" />
                <button class="search-btn" id="analyzeBtn" onclick="analyzeWallet()">Analyze</button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p class="loading-text" id="loadingText">Analyzing wallet on Base network...</p>
        </div>

        <div class="error" id="error">
            <div class="error-icon">‚ö†Ô∏è</div>
            <p class="error-message" id="errorMessage">Something went wrong</p>
        </div>

        <div class="results" id="results">
            <!-- Wallet Header -->
            <div class="wallet-header">
                <div class="wallet-info">
                    <div class="wallet-avatar" id="walletAvatar">üî∑</div>
                    <div>
                        <div class="wallet-address" id="walletAddress">0x...</div>
                        <div class="wallet-balance" id="walletBalance">0.00 ETH</div>
                        <div class="wallet-balance-usd" id="walletBalanceUsd">‚âà $0.00</div>
                    </div>
                </div>
                <div class="wallet-score">
                    <div class="score-circle" id="scoreCircle">
                        <span class="score-value" id="scoreValue">0</span>
                    </div>
                    <div class="score-label">Wallet Score</div>
                </div>
            </div>

            <!-- Personality -->
            <div class="personality-section">
                <div class="personality-badge" id="personalityBadge">
                    <span class="personality-icon" id="personalityIcon">üé≠</span>
                    <div>
                        <div class="personality-title" id="personalityTitle">Analyzing...</div>
                        <div class="personality-desc" id="personalityDesc">Determining wallet personality</div>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon blue">üìä</div>
                        <span class="stat-title">Total Transactions</span>
                    </div>
                    <div class="stat-value" id="totalTx">0</div>
                    <div class="stat-sub" id="txBreakdown">‚Üë 0 sent ‚Ä¢ ‚Üì 0 received</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon green">‚úÖ</div>
                        <span class="stat-title">Success Rate</span>
                    </div>
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-sub" id="successBreakdown">‚úì 0 success ‚Ä¢ ‚úó 0 failed</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon orange">‚õΩ</div>
                        <span class="stat-title">Gas Spent</span>
                    </div>
                    <div class="stat-value" id="gasSpent">0 ETH</div>
                    <div class="stat-sub" id="gasUsd">‚âà $0.00</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon red">üí∏</div>
                        <span class="stat-title">Wasted on Failed Tx</span>
                    </div>
                    <div class="stat-value" id="wastedGas">0 ETH</div>
                    <div class="stat-sub red" id="wastedUsd">Lost on failed transactions</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon purple">üìÖ</div>
                        <span class="stat-title">Wallet Age</span>
                    </div>
                    <div class="stat-value" id="walletAge">0 days</div>
                    <div class="stat-sub" id="firstTx">First tx: N/A</div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon cyan">üîÑ</div>
                        <span class="stat-title">Unique Contracts</span>
                    </div>
                    <div class="stat-value" id="uniqueContracts">0</div>
                    <div class="stat-sub" id="contractsDesc">Contracts interacted with</div>
                </div>
            </div>

            <!-- Achievements -->
            <div class="achievements-section">
                <h3 class="section-title">üèÜ Achievements</h3>
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- Filled by JS -->
                </div>
            </div>

            <!-- Heatmap -->
            <div class="heatmap-section">
                <h3 class="section-title">üìà Activity Heatmap (Last 52 weeks)</h3>
                <div class="heatmap-container">
                    <div class="heatmap" id="heatmap">
                        <!-- Filled by JS -->
                    </div>
                </div>
                <div class="heatmap-legend">
                    <span>Less</span>
                    <div class="heatmap-day"></div>
                    <div class="heatmap-day level-1"></div>
                    <div class="heatmap-day level-2"></div>
                    <div class="heatmap-day level-3"></div>
                    <div class="heatmap-day level-4"></div>
                    <div class="heatmap-day level-5"></div>
                    <span>More</span>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="transactions-section">
                <h3 class="section-title">üîó Recent Transactions</h3>
                <div class="tx-list" id="txList">
                    <!-- Filled by JS -->
                </div>
            </div>
        </div>

        <footer>
            <p>Built with üíô for Base network ‚Ä¢ Powered by <a href="https://basescan.org" target="_blank">Basescan API</a></p>
            <p style="margin-top: 10px;">¬© 2024 <a href="https://github.com/khunchan" target="_blank">khunchan</a></p>
        </footer>
    </div>

    <script>
        const API_KEY = 'DY9S61THQXFJ7FPF9W4Q3U5JDT9AGESNBF';
        const BASE_API = 'https://api.basescan.org/api';
        
        let ethPrice = 3500; // Default fallback

        // Personalities
        const PERSONALITIES = {
            degen: { icon: 'üé∞', title: 'Degen', desc: 'High-risk trader, loves to swap' },
            whale: { icon: 'üêã', title: 'Whale', desc: 'Big player, massive transactions' },
            diamond: { icon: 'üíé', title: 'Diamond Hands', desc: 'Patient holder, rarely trades' },
            shrimp: { icon: 'ü¶ê', title: 'Shrimp', desc: 'Small but active participant' },
            builder: { icon: 'üèóÔ∏è', title: 'Builder', desc: 'Deploys contracts, creates things' },
            bot: { icon: 'ü§ñ', title: 'Bot Suspect', desc: 'Unusually regular patterns' },
            ghost: { icon: 'üëª', title: 'Ghost', desc: 'Very low activity' },
            explorer: { icon: 'üß≠', title: 'Explorer', desc: 'Tries many different protocols' },
            newbie: { icon: 'üê£', title: 'Newbie', desc: 'Just getting started' }
        };

        // Achievements
        const ACHIEVEMENTS = [
            { id: 'first_tx', icon: 'üéØ', name: 'First Steps', check: (d) => d.totalTx >= 1 },
            { id: 'tx_10', icon: 'üîü', name: '10 Transactions', check: (d) => d.totalTx >= 10 },
            { id: 'tx_100', icon: 'üíØ', name: 'Century Club', check: (d) => d.totalTx >= 100 },
            { id: 'tx_1000', icon: 'üöÄ', name: 'Power User', check: (d) => d.totalTx >= 1000 },
            { id: 'gas_burner', icon: 'üî•', name: 'Gas Burner', check: (d) => d.gasSpent > 0.1 },
            { id: 'gas_whale', icon: '‚õΩ', name: 'Gas Whale', check: (d) => d.gasSpent > 1 },
            { id: 'fail_master', icon: '‚ùå', name: 'Fail Master', check: (d) => d.failedTx >= 10 },
            { id: 'perfect', icon: '‚ú®', name: 'Perfectionist', check: (d) => d.totalTx > 50 && d.failedTx === 0 },
            { id: 'og', icon: 'üéÇ', name: 'OG', check: (d) => d.walletAgeDays > 365 },
            { id: 'veteran', icon: 'üéñÔ∏è', name: 'Veteran', check: (d) => d.walletAgeDays > 180 },
            { id: 'explorer', icon: 'üß≠', name: 'Explorer', check: (d) => d.uniqueContracts >= 20 },
            { id: 'social', icon: 'ü§ù', name: 'Social Butterfly', check: (d) => d.uniqueAddresses >= 50 }
        ];

        function updateLoadingText(text) {
            document.getElementById('loadingText').textContent = text;
        }

        async function fetchAPI(url) {
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === '0' && data.message === 'NOTOK') {
                    console.error('API Error:', data.result);
                    return null;
                }
                
                return data;
            } catch (error) {
                console.error('Fetch error:', error);
                return null;
            }
        }

        async function getEthPrice() {
            try {
                const data = await fetchAPI(`${BASE_API}?module=stats&action=ethprice&apikey=${API_KEY}`);
                if (data && data.result && data.result.ethusd) {
                    ethPrice = parseFloat(data.result.ethusd);
                }
            } catch (e) {
                console.log('Using default ETH price');
            }
        }

        async function getBalance(address) {
            const data = await fetchAPI(`${BASE_API}?module=account&action=balance&address=${address}&apikey=${API_KEY}`);
            if (data && data.result) {
                return parseInt(data.result) / 1e18;
            }
            return 0;
        }

        async function getTransactions(address) {
            const data = await fetchAPI(`${BASE_API}?module=account&action=txlist&address=${address}&startblock=0&endblock=99999999&page=1&offset=10000&sort=desc&apikey=${API_KEY}`);
            
            if (data && data.result && Array.isArray(data.result)) {
                return data.result;
            }
            
            return [];
        }

        function shortenAddress(addr) {
            if (!addr || addr.length < 10) return addr;
            return `${addr.slice(0, 8)}...${addr.slice(-6)}`;
        }

        function formatEth(wei) {
            const value = parseInt(wei) / 1e18;
            if (value < 0.0001) return '< 0.0001';
            return value.toFixed(4);
        }

        function timeAgo(timestamp) {
            const seconds = Math.floor(Date.now() / 1000 - timestamp);
            if (seconds < 60) return `${seconds}s ago`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        function determinePersonality(data) {
            const { totalTx, avgValue, uniqueContracts, txFrequency, balance, failedTx } = data;
            
            if (totalTx === 0) return PERSONALITIES.newbie;
            if (totalTx < 5) return PERSONALITIES.ghost;
            if (txFrequency > 10) return PERSONALITIES.bot;
            if (balance > 10) return PERSONALITIES.whale;
            if (uniqueContracts > 30) return PERSONALITIES.explorer;
            if (totalTx > 100 && txFrequency < 0.5) return PERSONALITIES.diamond;
            if (avgValue > 1) return PERSONALITIES.degen;
            if (balance < 0.1 && totalTx > 20) return PERSONALITIES.shrimp;
            return PERSONALITIES.explorer;
        }

        function calculateScore(data) {
            let score = 50;
            
            // Activity
            if (data.totalTx > 10) score += 5;
            if (data.totalTx > 50) score += 5;
            if (data.totalTx > 100) score += 5;
            if (data.totalTx > 500) score += 5;
            
            // Success rate
            const successRate = data.totalTx > 0 ? (data.successTx / data.totalTx) : 0;
            score += Math.floor(successRate * 15);
            
            // Age
            if (data.walletAgeDays > 30) score += 3;
            if (data.walletAgeDays > 90) score += 3;
            if (data.walletAgeDays > 180) score += 4;
            if (data.walletAgeDays > 365) score += 5;
            
            // Diversity
            if (data.uniqueContracts > 5) score += 3;
            if (data.uniqueContracts > 20) score += 4;
            
            // Balance
            if (data.balance > 0.1) score += 3;
            if (data.balance > 1) score += 2;
            
            return Math.min(100, Math.max(0, score));
        }

        function generateHeatmap(transactions) {
            const heatmapEl = document.getElementById('heatmap');
            heatmapEl.innerHTML = '';
            
            // Get activity per day
            const activityMap = {};
            
            if (Array.isArray(transactions)) {
                transactions.forEach(tx => {
                    if (tx.timeStamp) {
                        const date = new Date(tx.timeStamp * 1000).toISOString().split('T')[0];
                        activityMap[date] = (activityMap[date] || 0) + 1;
                    }
                });
            }
            
            // Generate 52 weeks
            const today = new Date();
            for (let week = 51; week >= 0; week--) {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'heatmap-week';
                
                for (let day = 0; day < 7; day++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - (week * 7 + (6 - day)));
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const dayDiv = document.createElement('div');
                    dayDiv.className = 'heatmap-day';
                    
                    const count = activityMap[dateStr] || 0;
                    if (count > 0) {
                        if (count >= 20) dayDiv.classList.add('level-5');
                        else if (count >= 10) dayDiv.classList.add('level-4');
                        else if (count >= 5) dayDiv.classList.add('level-3');
                        else if (count >= 2) dayDiv.classList.add('level-2');
                        else dayDiv.classList.add('level-1');
                    }
                    
                    dayDiv.title = `${dateStr}: ${count} transactions`;
                    weekDiv.appendChild(dayDiv);
                }
                
                heatmapEl.appendChild(weekDiv);
            }
        }

        function renderAchievements(data) {
            const grid = document.getElementById('achievementsGrid');
            grid.innerHTML = '';
            
            ACHIEVEMENTS.forEach(ach => {
                const unlocked = ach.check(data);
                const div = document.createElement('div');
                div.className = `achievement ${unlocked ? 'unlocked' : 'locked'}`;
                div.innerHTML = `
                    <span class="achievement-icon">${ach.icon}</span>
                    <span class="achievement-name">${ach.name}</span>
                `;
                grid.appendChild(div);
            });
        }

        function renderTransactions(transactions, address) {
            const list = document.getElementById('txList');
            list.innerHTML = '';
            
            if (!Array.isArray(transactions) || transactions.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: var(--text-muted); padding: 20px;">No transactions found</p>';
                return;
            }
            
            const recent = transactions.slice(0, 10);
            recent.forEach(tx => {
                const isOut = tx.from && tx.from.toLowerCase() === address.toLowerCase();
                const div = document.createElement('div');
                div.className = 'tx-item';
                div.innerHTML = `
                    <div class="tx-left">
                        <div class="tx-icon ${isOut ? 'out' : 'in'}">${isOut ? '‚Üë' : '‚Üì'}</div>
                        <div>
                            <a href="https://basescan.org/tx/${tx.hash}" target="_blank" class="tx-hash">${shortenAddress(tx.hash)}</a>
                            <div class="tx-time">${timeAgo(tx.timeStamp)}</div>
                        </div>
                    </div>
                    <div class="tx-value">
                        <div class="tx-amount ${isOut ? 'out' : 'in'}">${isOut ? '-' : '+'}${formatEth(tx.value)} ETH</div>
                        <div class="tx-status">${tx.isError === '0' ? '‚úì Success' : '‚úó Failed'}</div>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        async function analyzeWallet() {
            const address = document.getElementById('addressInput').value.trim();
            
            if (!address || !address.match(/^0x[a-fA-F0-9]{40}$/)) {
                showError('Please enter a valid Ethereum address (0x...)');
                return;
            }
            
            // Show loading
            document.getElementById('loading').classList.add('active');
            document.getElementById('results').classList.remove('active');
            document.getElementById('error').classList.remove('active');
            document.getElementById('analyzeBtn').disabled = true;
            
            try {
                // Step 1: Get ETH price
                updateLoadingText('Fetching ETH price...');
                await getEthPrice();
                
                // Step 2: Get balance
                updateLoadingText('Fetching wallet balance...');
                const balance = await getBalance(address);
                
                // Step 3: Get transactions
                updateLoadingText('Fetching transactions (this may take a moment)...');
                const transactions = await getTransactions(address);
                
                console.log('Transactions received:', transactions.length);
                
                // Calculate stats
                updateLoadingText('Analyzing wallet data...');
                
                const totalTx = transactions.length;
                const successTx = transactions.filter(tx => tx.isError === '0').length;
                const failedTx = totalTx - successTx;
                
                let gasSpent = 0;
                let wastedGas = 0;
                const uniqueContractsSet = new Set();
                const uniqueAddressesSet = new Set();
                let totalValue = 0;
                
                transactions.forEach(tx => {
                    const gasUsed = parseInt(tx.gasUsed) || 0;
                    const gasPrice = parseInt(tx.gasPrice) || 0;
                    const gas = (gasUsed * gasPrice) / 1e18;
                    gasSpent += gas;
                    
                    if (tx.isError !== '0') {
                        wastedGas += gas;
                    }
                    
                    if (tx.to) {
                        uniqueAddressesSet.add(tx.to.toLowerCase());
                        if (tx.input && tx.input !== '0x') {
                            uniqueContractsSet.add(tx.to.toLowerCase());
                        }
                    }
                    
                    totalValue += (parseInt(tx.value) || 0) / 1e18;
                });
                
                const uniqueContracts = uniqueContractsSet.size;
                const uniqueAddresses = uniqueAddressesSet.size;
                
                // Wallet age
                let walletAgeDays = 0;
                let firstTxDate = 'N/A';
                if (transactions.length > 0) {
                    const firstTx = transactions[transactions.length - 1];
                    if (firstTx.timeStamp) {
                        const firstDate = new Date(firstTx.timeStamp * 1000);
                        firstTxDate = firstDate.toLocaleDateString();
                        walletAgeDays = Math.floor((Date.now() - firstDate.getTime()) / (1000 * 60 * 60 * 24));
                    }
                }
                
                // Tx frequency (per day)
                const txFrequency = walletAgeDays > 0 ? totalTx / walletAgeDays : totalTx;
                const avgValue = totalTx > 0 ? totalValue / totalTx : 0;
                
                const data = {
                    balance,
                    totalTx,
                    successTx,
                    failedTx,
                    gasSpent,
                    wastedGas,
                    uniqueContracts,
                    uniqueAddresses,
                    walletAgeDays,
                    txFrequency,
                    avgValue
                };
                
                // Update UI
                document.getElementById('walletAddress').textContent = shortenAddress(address);
                document.getElementById('walletBalance').textContent = `${balance.toFixed(4)} ETH`;
                document.getElementById('walletBalanceUsd').textContent = `‚âà $${(balance * ethPrice).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // Score
                const score = calculateScore(data);
                document.getElementById('scoreValue').textContent = score;
                document.getElementById('scoreCircle').style.setProperty('--score-percent', `${score}%`);
                
                // Personality
                const personality = determinePersonality(data);
                document.getElementById('personalityIcon').textContent = personality.icon;
                document.getElementById('personalityTitle').textContent = personality.title;
                document.getElementById('personalityDesc').textContent = personality.desc;
                
                // Stats
                document.getElementById('totalTx').textContent = totalTx.toLocaleString();
                const outTx = transactions.filter(tx => tx.from && tx.from.toLowerCase() === address.toLowerCase()).length;
                const inTx = totalTx - outTx;
                document.getElementById('txBreakdown').textContent = `‚Üë ${outTx} sent ‚Ä¢ ‚Üì ${inTx} received`;
                
                const successRatePercent = totalTx > 0 ? ((successTx / totalTx) * 100).toFixed(1) : 0;
                document.getElementById('successRate').textContent = `${successRatePercent}%`;
                document.getElementById('successBreakdown').textContent = `‚úì ${successTx} success ‚Ä¢ ‚úó ${failedTx} failed`;
                
                document.getElementById('gasSpent').textContent = `${gasSpent.toFixed(4)} ETH`;
                document.getElementById('gasUsd').textContent = `‚âà $${(gasSpent * ethPrice).toFixed(2)}`;
                
                document.getElementById('wastedGas').textContent = `${wastedGas.toFixed(4)} ETH`;
                document.getElementById('wastedUsd').textContent = `‚âà $${(wastedGas * ethPrice).toFixed(2)} lost`;
                
                document.getElementById('walletAge').textContent = walletAgeDays > 0 ? `${walletAgeDays} days` : 'New wallet';
                document.getElementById('firstTx').textContent = `First tx: ${firstTxDate}`;
                
                document.getElementById('uniqueContracts').textContent = uniqueContracts;
                
                // Achievements
                renderAchievements(data);
                
                // Heatmap
                generateHeatmap(transactions);
                
                // Transactions
                renderTransactions(transactions, address);
                
                // Show results
                document.getElementById('loading').classList.remove('active');
                document.getElementById('results').classList.add('active');
                
            } catch (err) {
                console.error('Error:', err);
                showError('Failed to fetch wallet data. Please check the address and try again.');
            }
            
            document.getElementById('analyzeBtn').disabled = false;
        }

        function showError(message) {
            document.getElementById('loading').classList.remove('active');
            document.getElementById('results').classList.remove('active');
            document.getElementById('error').classList.add('active');
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('analyzeBtn').disabled = false;
        }

        // Enter key support
        document.getElementById('addressInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') analyzeWallet();
        });
    </script>
</body>
</html>
